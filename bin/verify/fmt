#!/usr/bin/env bash
# =============================================================================
# fmt.sh
# Format all bash scripts using shfmt
# =============================================================================

set -euo pipefail

: "${DOTFILES_ROOT:?DOTFILES_ROOT must be set}"
: "${DRY_RUN:=false}"

source "$DOTFILES_ROOT/lib/core/log.sh"

log "ðŸŽ¨ Formatting shell scripts with shfmt..."

FILES=$(fd -e sh . "$DOTFILES_ROOT" \
  --exclude .git \
  --exclude node_modules)

if [ -z "$FILES" ]; then
    log_warn "No shell scripts found"
    exit 0
fi

if [ "$DRY_RUN" = true ]; then
    log_warn "âš¡ DRY_RUN mode: no files will be modified"
    shfmt -d -i 2 -ci -bn -sr $FILES
else
    shfmt -w -i 2 -ci -bn -sr $FILES
fi

log "âœ… Formatting complete"
