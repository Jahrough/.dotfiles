#!/usr/bin/env bash

# -----------------------------------------------------------------------------
# Homebrew Installation & Environment Setup
# -----------------------------------------------------------------------------
# - Installs Homebrew if not already present
# - Configures the Homebrew environment for both Apple Silicon and Intel Macs
# - Safe to re-run (idempotent)
# -----------------------------------------------------------------------------

install_homebrew() {
    # Check whether Homebrew is already installed
    if ! command -v brew >/dev/null 2>&1; then
        log "Installing Homebrew..."

        # Official Homebrew installation script
        /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
    else
        log "✅ Homebrew installed"
    fi
}

setup_homebrew_env() {
    # Homebrew installs to different prefixes depending on architecture:
    # - /opt/homebrew     → Apple Silicon (ARM)
    # - /usr/local        → Intel macOS
    #
    # Detect the active Homebrew binary and evaluate its shell environment
    # so `brew` and installed formulas are available immediately.
    for p in /opt/homebrew/bin /usr/local/bin; do
        [ -x "$p/brew" ] && eval "$($p/brew shellenv)"
    done
}
